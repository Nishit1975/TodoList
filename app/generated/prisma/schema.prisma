generator client {
  provider = "prisma-client-js"
  output   = "../app/generated/prisma"
}

datasource db {
  provider = "mysql"
}

model comments {
  comment_id Int     @id @default(autoincrement())
  content    String? @db.Text
  task_id    Int?
  user_id    Int?
  tasks      tasks?  @relation(fields: [task_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "comments_ibfk_1")
  users      users?  @relation(fields: [user_id], references: [userid], onDelete: Cascade, onUpdate: NoAction, map: "comments_ibfk_2")

  @@index([task_id], map: "task_id")
  @@index([user_id], map: "user_id")
}

model projects {
  project_id  Int                @id @default(autoincrement())
  name        String             @db.VarChar(255)
  description String?            @db.Text
  status      projects_status?   @default(Not_Started)
  priority    projects_priority? @default(Medium)
  start_date  DateTime?          @db.Date
  due_date    DateTime?          @db.Date
  created_at  DateTime?          @default(now()) @db.Timestamp(0)
  tasks       tasks[]
}

model subtasks {
  subtask_id Int      @id @default(autoincrement())
  title      String?  @db.VarChar(255)
  completed  Boolean? @default(false)
  task_id    Int
  tasks      tasks    @relation(fields: [task_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "subtasks_ibfk_1")

  @@index([task_id], map: "task_id")
}

model tags {
  tag_id    Int         @id @default(autoincrement())
  name      String      @unique(map: "name") @db.VarChar(100)
  task_tags task_tags[]
}

model task_tags {
  task_id Int
  tag_id  Int
  tasks   tasks @relation(fields: [task_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "task_tags_ibfk_1")
  tags    tags  @relation(fields: [tag_id], references: [tag_id], onDelete: Cascade, onUpdate: NoAction, map: "task_tags_ibfk_2")

  @@id([task_id, tag_id])
  @@index([tag_id], map: "tag_id")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model tasks {
  id                               Int             @id @default(autoincrement())
  title                            String          @db.VarChar(255)
  description                      String?         @db.Text
  status                           tasks_status?   @default(NOT_STARTED)
  priority                         tasks_priority? @default(MEDIUM)
  due_date                         DateTime?       @db.DateTime(0)
  project_id                       Int?
  assignee_id                      Int
  created_by_id                    Int
  created_at                       DateTime?       @default(now()) @db.Timestamp(0)
  comments                         comments[]
  subtasks                         subtasks[]
  task_tags                        task_tags[]
  projects                         projects?       @relation(fields: [project_id], references: [project_id], onUpdate: NoAction, map: "tasks_ibfk_1")
  users_tasks_assignee_idTousers   users           @relation("tasks_assignee_idTousers", fields: [assignee_id], references: [userid], onDelete: Cascade, onUpdate: NoAction, map: "tasks_ibfk_2")
  users_tasks_created_by_idTousers users           @relation("tasks_created_by_idTousers", fields: [created_by_id], references: [userid], onDelete: Cascade, onUpdate: NoAction, map: "tasks_ibfk_3")

  @@index([assignee_id], map: "assignee_id")
  @@index([created_by_id], map: "created_by_id")
  @@index([project_id], map: "project_id")
}

model users {
  userid                           Int        @id @default(autoincrement())
  username                         String     @db.VarChar(100)
  email                            String     @unique(map: "email") @db.VarChar(150)
  password                         String     @db.VarChar(255)
  role                             String?    @default("user") @db.VarChar(50)
  is_active                        Boolean?   @default(true)
  created_at                       DateTime?  @default(now()) @db.Timestamp(0)
  updated_at                       DateTime?  @default(now()) @db.Timestamp(0)
  comments                         comments[]
  tasks_tasks_assignee_idTousers   tasks[]    @relation("tasks_assignee_idTousers")
  tasks_tasks_created_by_idTousers tasks[]    @relation("tasks_created_by_idTousers")
}

enum projects_status {
  Not_Started @map("Not Started")
  In_Progress @map("In Progress")
  Review
  Completed
}

enum tasks_status {
  NOT_STARTED
  IN_PROGRESS
  IN_REVIEW
  DONE
}

enum projects_priority {
  Low
  Medium
  High
}

enum tasks_priority {
  LOW
  MEDIUM
  HIGH
}
